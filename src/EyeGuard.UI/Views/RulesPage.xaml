<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="EyeGuard.UI.Views.RulesPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Background="Transparent">

    <ScrollViewer Padding="32">
        <StackPanel Spacing="24" MaxWidth="700">
            
            <TextBlock Text="监测规则" FontSize="28" FontWeight="SemiBold"/>

            <!-- 模式切换区 -->
            <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1" CornerRadius="8" Padding="20">
                <StackPanel Spacing="12">
                    <TextBlock Text="监测模式" FontWeight="SemiBold" FontSize="16"/>
                    
                    <StackPanel Orientation="Horizontal" Spacing="24">
                        <RadioButton x:Name="SimpleModeRadio" 
                                     Content="简单模式" 
                                     GroupName="MonitorMode"
                                     Checked="ModeRadio_Checked"/>
                        <RadioButton x:Name="SmartModeRadio" 
                                     Content="智能模式" 
                                     IsChecked="True"
                                     GroupName="MonitorMode"
                                     Checked="ModeRadio_Checked"/>
                    </StackPanel>
                    
                    <!-- 模式描述 -->
                    <Border Background="{ThemeResource LayerFillColorDefaultBrush}" 
                            CornerRadius="6" Padding="12" Margin="0,4,0,0">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE946;" FontSize="14" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                            <TextBlock x:Name="ModeDescriptionText"
                                       Text="智能模式通过检测键鼠活动、音频播放等多种方式自动判断您是否在使用电脑，并动态计算疲劳值。推荐使用。"
                                       FontSize="12" TextWrapping="Wrap"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Border>

            <!-- ========== 简单模式设置 ========== -->
            <StackPanel x:Name="SimpleModePanel" Spacing="16" Visibility="Collapsed">
                
                <TextBlock Text="休息规则" FontSize="20" FontWeight="SemiBold"/>
                
                <!-- 短休息规则 -->
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1" CornerRadius="8" Padding="20">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <FontIcon Glyph="&#xE916;" FontSize="28" 
                                  Foreground="#8A2BE2"
                                  VerticalAlignment="Center" Margin="0,0,16,0"/>
                        
                        <StackPanel Grid.Column="1" Spacing="8">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="短休息 (Micro-break)" FontSize="16" FontWeight="SemiBold"/>
                                <FontIcon Glyph="&#xE946;" FontSize="12" 
                                          Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                          VerticalAlignment="Center"
                                          ToolTipService.ToolTip="短休息适合缓解眼部疲劳，建议每15-20分钟休息20秒，远眺窗外或闭眼休息。"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="每工作" VerticalAlignment="Center"/>
                                <NumberBox x:Name="MicroBreakIntervalBox"
                                           Value="15" Minimum="5" Maximum="60"
                                           SpinButtonPlacementMode="Compact" Width="90"/>
                                <TextBlock Text="分钟后，休息" VerticalAlignment="Center"/>
                                <NumberBox x:Name="MicroBreakDurationBox"
                                           Value="20" Minimum="10" Maximum="120"
                                           SpinButtonPlacementMode="Compact" Width="90"/>
                                <TextBlock Text="秒" VerticalAlignment="Center"/>
                            </StackPanel>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- 长休息规则 -->
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1" CornerRadius="8" Padding="20">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <FontIcon Glyph="&#xE823;" FontSize="28" 
                                  Foreground="#8A2BE2"
                                  VerticalAlignment="Center" Margin="0,0,16,0"/>
                        
                        <StackPanel Grid.Column="1" Spacing="8">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="长休息 (Long-break)" FontSize="16" FontWeight="SemiBold"/>
                                <FontIcon Glyph="&#xE946;" FontSize="12" 
                                          Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                          VerticalAlignment="Center"
                                          ToolTipService.ToolTip="长休息适合全身放松，建议每45-60分钟起身活动5分钟，喝水、伸展或简单走动。"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="每工作" VerticalAlignment="Center"/>
                                <NumberBox x:Name="LongBreakIntervalBox"
                                           Value="45" Minimum="15" Maximum="120"
                                           SpinButtonPlacementMode="Compact" Width="90"/>
                                <TextBlock Text="分钟后，休息" VerticalAlignment="Center"/>
                                <NumberBox x:Name="LongBreakDurationBox"
                                           Value="5" Minimum="1" Maximum="30"
                                           SpinButtonPlacementMode="Compact" Width="90"/>
                                <TextBlock Text="分钟" VerticalAlignment="Center"/>
                            </StackPanel>
                        </StackPanel>
                    </Grid>
                </Border>
            </StackPanel>

            <!-- ========== 智能模式设置 ========== -->
            <StackPanel x:Name="SmartModePanel" Spacing="16">
                
                <TextBlock Text="疲劳度设置" FontSize="20" FontWeight="SemiBold"/>
                
                <!-- 疲劳阈值设置 -->
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1" CornerRadius="8" Padding="20">
                    <StackPanel Spacing="16">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="休息提醒阈值" FontSize="16" FontWeight="SemiBold"/>
                            <FontIcon Glyph="&#xE946;" FontSize="12" 
                                      Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                      VerticalAlignment="Center"
                                      ToolTipService.ToolTip="当疲劳度达到此值时，系统会弹出休息提醒。疲劳度基于连续工作时间动态计算。"/>
                        </StackPanel>
                        
                        <Grid ColumnSpacing="16" RowSpacing="12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="80"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="50"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>
                            
                            <TextBlock Text="轻度提醒:" VerticalAlignment="Center"/>
                            <Slider x:Name="SoftReminderSlider" Grid.Column="1"
                                    Minimum="20" Maximum="80" Value="40"
                                    TickFrequency="10" TickPlacement="Outside"/>
                            <TextBlock x:Name="SoftReminderText" Grid.Column="2" Text="40%" VerticalAlignment="Center"/>
                            
                            <TextBlock Grid.Row="1" Text="强制休息:" VerticalAlignment="Center"/>
                            <Slider x:Name="ForceBreakSlider" Grid.Row="1" Grid.Column="1"
                                    Minimum="50" Maximum="100" Value="80"
                                    TickFrequency="10" TickPlacement="Outside"/>
                            <TextBlock x:Name="ForceBreakText" Grid.Row="1" Grid.Column="2" Text="80%" VerticalAlignment="Center"/>
                        </Grid>
                    </StackPanel>
                </Border>

                <TextBlock Text="检测方式" FontSize="20" FontWeight="SemiBold"/>

                <!-- 检测选项列表 -->
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1" CornerRadius="8" Padding="20">
                    <StackPanel Spacing="16">
                        
                        <!-- 鼠标检测 -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="鼠标/触摸板活动" VerticalAlignment="Center"/>
                                <FontIcon Glyph="&#xE946;" FontSize="12" 
                                          Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                          VerticalAlignment="Center"
                                          ToolTipService.ToolTip="检测鼠标点击和滚轮操作（不包括移动，避免误判）。此为核心检测方式，始终启用。"/>
                            </StackPanel>
                            <FontIcon Grid.Column="1" Glyph="&#xE73E;" Foreground="#8A2BE2"/>
                        </Grid>
                        
                        <Rectangle Height="1" Fill="{ThemeResource DividerStrokeColorDefaultBrush}"/>
                        
                        <!-- 键盘检测 -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="键盘活动" VerticalAlignment="Center"/>
                                <FontIcon Glyph="&#xE946;" FontSize="12" 
                                          Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                          VerticalAlignment="Center"
                                          ToolTipService.ToolTip="检测键盘按键。Limit 只记录是否有按键，不记录具体内容，保护您的隐私。"/>
                            </StackPanel>
                            <ToggleSwitch x:Name="KeyboardToggle" Grid.Column="1" IsOn="True" OnContent="" OffContent=""/>
                        </Grid>
                        
                        <Rectangle Height="1" Fill="{ThemeResource DividerStrokeColorDefaultBrush}"/>
                        
                        <!-- 音频检测 -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="音频播放检测" VerticalAlignment="Center"/>
                                <FontIcon Glyph="&#xE946;" FontSize="12" 
                                          Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                          VerticalAlignment="Center"
                                          ToolTipService.ToolTip="检测系统是否有音频输出（看视频/听音乐）。有音频时会进入「媒体模式」，空闲判定阈值延长至2分钟。"/>
                            </StackPanel>
                            <ToggleSwitch x:Name="AudioToggle" Grid.Column="1" IsOn="True" OnContent="" OffContent=""/>
                        </Grid>
                        
                        <Rectangle Height="1" Fill="{ThemeResource DividerStrokeColorDefaultBrush}"/>
                        
                        <!-- 空闲阈值 -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="空闲判定时间" VerticalAlignment="Center"/>
                                <FontIcon Glyph="&#xE946;" FontSize="12" 
                                          Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                          VerticalAlignment="Center"
                                          ToolTipService.ToolTip="无键鼠活动超过此时间后，判定为用户空闲，疲劳值开始恢复。"/>
                            </StackPanel>
                            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                                <NumberBox x:Name="IdleThresholdBox" Value="60" Minimum="30" Maximum="300"
                                           SpinButtonPlacementMode="Compact" Width="100"/>
                                <TextBlock Text="秒" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>
            </StackPanel>

            <!-- 提醒设置（两个模式共用） -->
            <TextBlock Text="提醒设置" FontSize="20" FontWeight="SemiBold"/>
            
            <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1" CornerRadius="8" Padding="20">
                <StackPanel Spacing="16">
                    <!-- 开启提醒 -->
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="开启休息提醒" VerticalAlignment="Center"/>
                        <ToggleSwitch x:Name="EnableRemindersToggle" Grid.Column="1" IsOn="True" OnContent="" OffContent=""/>
                    </Grid>
                    
                    <Rectangle Height="1" Fill="{ThemeResource DividerStrokeColorDefaultBrush}"/>
                    
                    <!-- 提醒方式 -->
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="提醒方式" VerticalAlignment="Center"/>
                            <FontIcon Glyph="&#xE946;" FontSize="12" 
                                      Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                      VerticalAlignment="Center"
                                      ToolTipService.ToolTip="全屏弹窗会覆盖整个屏幕（可通过按钮跳过）；通知横幅只在角落显示提示，不会打断工作。"/>
                        </StackPanel>
                        <ComboBox x:Name="ReminderTypeCombo" Grid.Column="1" Width="140" SelectedIndex="0">
                            <ComboBoxItem Content="全屏弹窗"/>
                            <ComboBoxItem Content="通知横幅"/>
                        </ComboBox>
                    </Grid>
                </StackPanel>
            </Border>

            <!-- 保存按钮 -->
            <StackPanel Orientation="Horizontal" Spacing="12" HorizontalAlignment="Right" Margin="0,8,0,0">
                <Button x:Name="SaveButton" Content="保存设置" Style="{StaticResource AccentButtonStyle}" 
                        Click="SaveButton_Click" MinWidth="120"/>
                <TextBlock x:Name="SaveStatusText" Text="" VerticalAlignment="Center" Foreground="Green"/>
            </StackPanel>

        </StackPanel>
    </ScrollViewer>
</Page>
